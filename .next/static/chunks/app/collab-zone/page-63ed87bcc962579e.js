(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[955],{1762:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>O});var s=i(7907),n=i(9107),a=i(4377),l=i(5698),c=i(7956),o=i(3858),r=i(3827),d=i(9595),u=i(865),g=i(5223),x=i(9243),h=i(6097),p=i(9625),f=i(97),j=i(61),m=i(1207),y=i(3946),A=i(4709),b=i(967),v=i(7504),w=i(2401),N=i(9425),S=i(4551),k=i(5004),z=i(4341),C=i(4768),T=i(4324),B=i(3137),_=i(1723);function E(e){let{content:t,setContent:i}=e,n=(0,c.hG)({extensions:[m.A,o.A.configure({heading:!1}),r.A,d.Ay,u.A.configure({types:["heading","paragraph"]}),g.A.configure({levels:[1,2]}),x.A,h.Ay,p.Ay,f.Ay,j.Ay],content:t,onUpdate:e=>{let{editor:t}=e;i(t.getHTML())}});if(!n)return null;let a=(e,t,i)=>(0,s.jsx)("button",{type:"button",onClick:e,className:"p-1 rounded ".concat(t?"bg-accent/40":""),children:i});return(0,s.jsxs)("div",{children:[(0,s.jsxs)("div",{className:"flex flex-wrap gap-1 p-2 border-b bg-card",children:[a(()=>n.chain().focus().toggleBold().run(),n.isActive("bold"),(0,s.jsx)(y.A,{size:16})),a(()=>n.chain().focus().toggleItalic().run(),n.isActive("italic"),(0,s.jsx)(A.A,{size:16})),a(()=>n.chain().focus().toggleUnderline().run(),n.isActive("underline"),(0,s.jsx)(b.A,{size:16})),a(()=>n.chain().focus().toggleStrike().run(),n.isActive("strike"),(0,s.jsx)(v.A,{size:16})),a(()=>n.chain().focus().toggleHeading({level:1}).run(),n.isActive("heading",{level:1}),(0,s.jsx)("span",{className:"font-semibold",children:"H1"})),a(()=>n.chain().focus().toggleHeading({level:2}).run(),n.isActive("heading",{level:2}),(0,s.jsx)("span",{className:"font-semibold",children:"H2"})),a(()=>n.chain().focus().toggleBulletList().run(),n.isActive("bulletList"),(0,s.jsx)(w.A,{size:16})),a(()=>n.chain().focus().toggleOrderedList().run(),n.isActive("orderedList"),(0,s.jsx)(N.A,{size:16})),a(()=>n.chain().focus().toggleBlockquote().run(),n.isActive("blockquote"),(0,s.jsx)(S.A,{size:16})),a(()=>n.chain().focus().toggleCodeBlock().run(),n.isActive("codeBlock"),(0,s.jsx)(k.A,{size:16})),a(()=>{let e=prompt("Enter URL");e&&n.chain().focus().extendMarkRange("link").setLink({href:e}).run()},n.isActive("link"),(0,s.jsx)(z.A,{size:16})),a(()=>n.chain().focus().setTextAlign("left").run(),n.isActive({textAlign:"left"}),(0,s.jsx)(C.A,{size:16})),a(()=>n.chain().focus().setTextAlign("center").run(),n.isActive({textAlign:"center"}),(0,s.jsx)(T.A,{size:16})),a(()=>n.chain().focus().setTextAlign("right").run(),n.isActive({textAlign:"right"}),(0,s.jsx)(B.A,{size:16})),a(()=>n.chain().focus().setTextAlign("justify").run(),n.isActive({textAlign:"justify"}),(0,s.jsx)(_.A,{size:16}))]}),(0,s.jsx)(c.$Z,{editor:n,className:"min-h-[300px] p-4 overflow-auto"})]})}function O(){let e=(0,a.useRouter)(),[t,i]=(0,n.useState)([]),[c,o]=(0,n.useState)(null),[r,d]=(0,n.useState)(""),[u,g]=(0,n.useState)(null),[x,h]=(0,n.useState)(""),[p,f]=(0,n.useState)(!1),[j,m]=(0,n.useState)(""),[y,A]=(0,n.useState)(null);(0,n.useEffect)(()=>{let t=localStorage.getItem("growfly_jwt");if(!t)return e.push("/login");fetch("/api/collab",{headers:{Authorization:"Bearer ".concat(t)}}).then(e=>e.json()).then(e=>{i(e),e.length&&(o(e[0].id),d(e[0].content))}).catch(()=>i([]))},[e]),(0,n.useEffect)(()=>{if(!c)return;let e=t.find(e=>e.id===c);e&&d(e.content)},[c,t]);let b=async()=>{let e=localStorage.getItem("growfly_jwt"),t=await fetch("/api/collab",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(e)},body:JSON.stringify({title:"Untitled",content:""})}),s=await t.json();i(e=>[s,...e]),o(s.id),d("")},v=async()=>{var e;if(!c)return alert("Select a document first");let s=localStorage.getItem("growfly_jwt");(await fetch("/api/collab/".concat(c),{method:"PUT",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(s)},body:JSON.stringify({content:r,title:null==(e=t.find(e=>e.id===c))?void 0:e.title})})).ok?(i(e=>e.map(e=>e.id===c?{...e,content:r}:e)),A({type:"success",text:"Saved!"})):A({type:"error",text:"Save failed."})},w=async e=>{let t=localStorage.getItem("growfly_jwt");(await fetch("/api/collab/".concat(e),{method:"PUT",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(t)},body:JSON.stringify({title:x})})).ok?(i(t=>t.map(t=>t.id===e?{...t,title:x}:t)),g(null),A({type:"success",text:"Renamed!"})):A({type:"error",text:"Rename failed."})},N=async e=>{if(!confirm("Delete this document?"))return;let s=localStorage.getItem("growfly_jwt");if((await fetch("/api/collab/".concat(e),{method:"DELETE",headers:{Authorization:"Bearer ".concat(s)}})).ok){let s=t.filter(t=>t.id!==e);i(s),c===e&&(s.length?(o(s[0].id),d(s[0].content)):(o(null),d("")))}else A({type:"error",text:"Delete failed."})},S=async()=>{if(!c||!j.includes("@"))return A({type:"error",text:"Enter a valid email."});let e=localStorage.getItem("growfly_jwt"),t=await fetch("/api/collab/".concat(c,"/share"),{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(e)},body:JSON.stringify({email:j})});if(t.ok){let e="".concat(window.location.origin,"/collab-zone?doc=").concat(c);navigator.clipboard.writeText(e),A({type:"success",text:"Shared & link copied!"})}else{let{error:e}=await t.json().catch(()=>({}));A({type:"error",text:e||"Share failed."})}};return(0,s.jsxs)("div",{className:"flex h-full",children:[(0,s.jsxs)("aside",{className:"w-64 border-r bg-background p-4 space-y-3 overflow-auto",children:[(0,s.jsxs)("button",{onClick:b,className:"flex items-center gap-1 px-3 py-2 bg-blue-600 text-white rounded",children:[(0,s.jsx)(l.GGD,{})," New Doc"]}),t.map(e=>(0,s.jsxs)("div",{className:"flex items-center justify-between px-2 py-1 rounded cursor-pointer ".concat(e.id===c?"bg-accent/20":"hover:bg-muted"),onClick:()=>o(e.id),children:[u===e.id?(0,s.jsx)("input",{className:"w-full px-1 py-0.5 border rounded",value:x,onChange:e=>h(e.target.value),onBlur:()=>w(e.id),autoFocus:!0}):(0,s.jsx)("span",{className:"truncate",onDoubleClick:()=>{g(e.id),h(e.title)},children:e.title}),(0,s.jsxs)("div",{className:"flex gap-1",children:[(0,s.jsx)(l.Pj4,{className:"cursor-pointer",onClick:()=>{g(e.id),h(e.title)}}),(0,s.jsx)(l.IXo,{className:"cursor-pointer text-red-600",onClick:()=>N(e.id)})]})]},e.id))]}),(0,s.jsxs)("main",{className:"flex-1 p-6 space-y-4",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsx)("h1",{className:"text-3xl font-bold flex items-center gap-2",children:"Collab Zone"}),(0,s.jsxs)("button",{onClick:()=>{f(!0),m(""),A(null)},className:"flex items-center gap-1 px-4 py-2 bg-gray-600 hover:bg-gray-700 text-white rounded",children:[(0,s.jsx)(l.pHD,{})," Share This Doc"]})]}),(0,s.jsx)("p",{className:"text-gray-400",children:"Share and collaborate on Growfly responses."}),p&&(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("input",{type:"email",value:j,placeholder:"Enter colleagueâ€™s email",onChange:e=>m(e.target.value),className:"flex-1 px-3 py-2 border rounded"}),(0,s.jsxs)("button",{onClick:S,className:"px-4 py-2 bg-blue-600 text-white rounded flex items-center gap-1",children:[(0,s.jsx)(l.A3x,{})," Send"]})]}),y&&(0,s.jsxs)("div",{className:"flex items-center gap-2 px-3 py-2 rounded ".concat("success"===y.type?"bg-green-100 text-green-800":"bg-red-100 text-red-800"),children:["success"===y.type?(0,s.jsx)(l.A3x,{}):(0,s.jsx)(l.y3G,{}),(0,s.jsx)("span",{children:y.text})]}),(0,s.jsx)("div",{className:"border rounded-lg overflow-hidden",children:(0,s.jsx)(E,{content:r,setContent:d})}),(0,s.jsxs)("button",{onClick:v,className:"flex items-center gap-1 px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded",children:[(0,s.jsx)(l.Bc_,{})," Save"]})]})]})}},4994:(e,t,i)=>{Promise.resolve().then(i.bind(i,1762))}},e=>{var t=t=>e(e.s=t);e.O(0,[305,4,165,577,548,784,358],()=>t(4994)),_N_E=e.O()}]);